<h2 id="цель-лабораторной-работы">Цель лабораторной работы</h2>
<ul>
<li>Развить навыки администрирования ОС Linux. Получить первое
практическое знакомство с технологией SELinux1. Проверить работу SELinx
на практике совместно с веб-сервером Apache</li>
</ul>
<h2 id="теоретическая-справка-1">Теоретическая справка (1)</h2>
<ol type="1">
<li><strong>SELinux (Security-Enhanced Linux)</strong> обеспечивает
усиление защиты путем внесения изменений как на уровне ядра, так и на
уровне пространства пользователя, что превращает ее в действительно
«непробиваемую» операционную систему</li>
</ol>
<h2 id="теоретическая-справка-1-1">Теоретическая справка (1)</h2>
<p><em>SELinux имеет три основных режим работы:</em></p>
<ul>
<li><p>Enforcing: режим по умолчанию. При выборе этого режима все
действия, которые каким-то образом нарушают текущую политику
безопасности, будут блокироваться, а попытка нарушения будет
зафиксирована в журнале.</p></li>
<li><p>Permissive: в случае использования этого режима, информация о
всех действиях, которые нарушают текущую политику безопасности, будут
зафиксированы в журнале, но сами действия не будут
заблокированы.</p></li>
<li><p>Disabled: полное отключение системы принудительного контроля
доступа.</p></li>
</ul>
<h2 id="теоретическая-справка-2">Теоретическая справка (2)</h2>
<ol start="2" type="1">
<li><strong>Apache</strong> — это свободное программное обеспечение, с
помощью которого можно создать веб-сервер. Данный продукт возник как
доработанная версия другого HTTP-клиента от национального центра
суперкомпьютерных приложений (NCSA)</li>
</ol>
<h2 id="теоретическая-справка-2-1">Теоретическая справка (2)</h2>
<p><em>Для чего нужен Apache сервер:</em></p>
<ul>
<li><p>чтобы открывать динамические PHP-страницы,</p></li>
<li><p>для распределения поступающей на сервер нагрузки,</p></li>
<li><p>для обеспечения отказоустойчивости сервера,</p></li>
<li><p>чтобы потренироваться в настройке сервера и запуске
PHP-скриптов.</p></li>
</ul>
<h1 id="ход-выполнения-лабораторной-работы">Ход выполнения лабораторной
работы</h1>
<h2 id="выполнение-лабораторной-работы">Выполнение лабораторной
работы</h2>
<p>Убедились, что SELinux работает в режиме enforcing политики
targeted</p>
<figure id="fig:001">
<img src="image/image1.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 1. Проверка режима enforcing политики targeted)" />
<figcaption aria-hidden="true">(рис. 1. Проверка режима enforcing
политики targeted)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-1">Выполнение лабораторной
работы</h2>
<p>Обратились с помощью браузера к веб-серверу, запущенному на
компьютере, и убедились, что последний работает</p>
<figure id="fig:002">
<img src="image/image2.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 2. Проверка работы веб-сервера)" />
<figcaption aria-hidden="true">(рис. 2. Проверка работы
веб-сервера)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-2">Выполнение лабораторной
работы</h2>
<p>Определили контекст безопасности веб-сервера Apache</p>
<figure id="fig:003">
<img src="image/image3.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 3. Контекст безопасности веб-сервера Apache)" />
<figcaption aria-hidden="true">(рис. 3. Контекст безопасности
веб-сервера Apache)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-3">Выполнение лабораторной
работы</h2>
<p>Посмотрели текущее состояние переключателей, многие из переключателей
находятся в положении “off”</p>
<figure id="fig:004">
<img src="image/image4.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 4. Текущее состояние переключателей SELinux)" />
<figcaption aria-hidden="true">(рис. 4. Текущее состояние переключателей
SELinux)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-4">Выполнение лабораторной
работы</h2>
<p>Посмотрели статистику по политике. Множество пользователей - 8, ролей
- 14, типов 5100</p>
<figure id="fig:005">
<img src="image/image5.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 5. Статистика по политике)" />
<figcaption aria-hidden="true">(рис. 5. Статистика по
политике)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-5">Выполнение лабораторной
работы</h2>
<p>Посмотрели файлы и поддиректории, находящиеся в директории /var/www.
Определили, что в данной директории файлов нет. Только
владелец/суперпользователь может создавать файлы в директории
/var/www/html</p>
<figure id="fig:006">
<img src="image/image6.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 6. Просмотр файлов и поддиректориий в директории /var/www)" />
<figcaption aria-hidden="true">(рис. 6. Просмотр файлов и поддиректориий
в директории /var/www)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-6">Выполнение лабораторной
работы</h2>
<p>От имени суперпользователя создали html-файл. Контекст созданного
файла - httpd_sys_content_t</p>
<figure id="fig:007">
<img src="image/image7.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 7. Создание файла /var/www/html/test.html)" />
<figcaption aria-hidden="true">(рис. 7. Создание файла
/var/www/html/test.html)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-7">Выполнение лабораторной
работы</h2>
<p>Обратились к файлу через веб-сервер, введя в браузере адрес
“http://127.0.0.1/test.html”. Файл был успешно отображен</p>
<figure id="fig:008">
<img src="image/image8.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 8. Обращение к файлу через веб-сервер)" />
<figcaption aria-hidden="true">(рис. 8. Обращение к файлу через
веб-сервер)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-8">Выполнение лабораторной
работы</h2>
<p>Изучив справку httpd_selinux, выяснили, какие контексты определены
для файлов httpd.</p>
<p>Контекст моего файла - httpd_sys_content_t (в таком случае содержимое
должно быть доступно для всех скриптов httpd и для самого демона).
Изменили контекст файла на samba_share_t</p>
<figure id="fig:009">
<img src="image/image9.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 9. Изменение контекста)" />
<figcaption aria-hidden="true">(рис. 9. Изменение
контекста)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-9">Выполнение лабораторной
работы</h2>
<p>Попробовали еще раз получить доступ к файлу через веб-сервер, введя в
браузере адрес “http://127.0.0.1/test.html” и получили сообщение об
ошибке (т.к. кустановленному ранее контексту процесс httpd не имеет
доступа)</p>
<figure id="fig:010">
<img src="image/image10.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 10. Обращение к файлу через веб-сервер)" />
<figcaption aria-hidden="true">(рис. 10. Обращение к файлу через
веб-сервер)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-10">Выполнение лабораторной
работы</h2>
<p>Убедились, что читать данный файл может любой пользователь.
Просмотрели системный лог-файл веб-сервера Apache, отображающий
ошибки</p>
<figure id="fig:011">
<img src="image/image11.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 11. Просмотр log-файла)" />
<figcaption aria-hidden="true">(рис. 11. Просмотр
log-файла)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-11">Выполнение лабораторной
работы</h2>
<p>В файле /etc/httpd/conf/httpd.conf заменили строчку “Listen 80” на
“Listen 81”, чтобы установить веб-сервер Apache на прослушивание
TCP-порта 81</p>
<figure id="fig:012">
<img src="image/image12.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 12. Установка веб-сервера Apache на прослушивание TCP-порта 81)" />
<figcaption aria-hidden="true">(рис. 12. Установка веб-сервера Apache на
прослушивание TCP-порта 81)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-12">Выполнение лабораторной
работы</h2>
<p>Перезапускаем веб-сервер Apache и анализируем лог-файлы командой
“tail -nl /var/log/messages”</p>
<figure id="fig:013">
<img src="image/image13.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 13. Перезапуск веб-сервера и анализ лог-файлов)" />
<figcaption aria-hidden="true">(рис. 13. Перезапуск веб-сервера и анализ
лог-файлов)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-13">Выполнение лабораторной
работы</h2>
<p>Просмотрели файлы “var/log/http/error_log”,
“/var/log/http/access_log” и “/var/log/audit/audit.log” и выяснили, что
запись появилась в последнем файле</p>
<figure id="fig:014">
<img src="image/image14.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 14. Содержание файла var/log/audit/audit.log)" />
<figcaption aria-hidden="true">(рис. 14. Содержание файла
var/log/audit/audit.log)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-14">Выполнение лабораторной
работы</h2>
<p>Проверили список портов командой, убедились, что порт 81 есть в
списке и запускаем веб-сервер Apache снова</p>
<figure id="fig:015">
<img src="image/image15.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 15. Проверка установки порта 81)" />
<figcaption aria-hidden="true">(рис. 15. Проверка установки порта
81)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-15">Выполнение лабораторной
работы</h2>
<p>Вернули контекст “httpd_sys_cоntent_t” файлу
“/var/www/html/test.html” и попробовали получить доступ к файлу через
веб-сервер, введя адрес “http://127.0.0.1:81/test.html”, увидели
содежимое файла - слово “test”</p>
<figure id="fig:017">
<img src="image/image17.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 17. Обращение к файлу через веб-сервер)" />
<figcaption aria-hidden="true">(рис. 17. Обращение к файлу через
веб-сервер)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-16">Выполнение лабораторной
работы</h2>
<p>Исправили обратно конфигурационный файл apache, вернув “Listen 80”.
Попытались удалить привязку http_port к 81 порту, но этот порт определен
на уровне политики, поэтому его нельзя удалить</p>
<figure id="fig:018">
<img src="image/image18.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 18. Возвращение Listen 80 и попытка удалить порт 81)" />
<figcaption aria-hidden="true">(рис. 18. Возвращение Listen 80 и попытка
удалить порт 81)</figcaption>
</figure>
<h2 id="выполнение-лабораторной-работы-17">Выполнение лабораторной
работы</h2>
<p>Удалили файл “/var/www/html/test.html”</p>
<figure id="fig:019">
<img src="image/image19.PNG" style="width:70.0%;height:70.0%"
alt="(рис. 19. Удаление файла test.html)" />
<figcaption aria-hidden="true">(рис. 19. Удаление файла
test.html)</figcaption>
</figure>
<h1 id="вывод">Вывод</h1>
<p>В ходе выполнения данной лабораторной работы были развиты навыки
администрирования ОС Linux, получено первое практическое знакомство с
технологией SELinux и проверена работа SELinux на практике совместно с
веб-сервером Apache.</p>
<h1 id="список-литературы.-библиография">Список литературы.
Библиография</h1>
<p>[0] Методические материалы курса</p>
<p>[1] SELinux:
https://habr.com/ru/companies/kingservers/articles/209644/</p>
<p>[2] Apache:
https://2domains.ru/support/vps-i-servery/shto-takoye-apache</p>
